"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
exports.__esModule = true;
var path_1 = __importDefault(require("path"));
var pathHost_1 = __importDefault(require("./pathHost"));
var root = process.cwd();
// eslint-disable-next-line
var tsconfigInfo = require(path_1["default"].join(root, './tsconfig.json'));
var setBaseUrl = tsconfigInfo.compilerOptions.baseUrl || './';
var baseUrl = path_1["default"].join(root, setBaseUrl);
var aliasMapPaths = tsconfigInfo.compilerOptions.paths;
var pathHost = new pathHost_1["default"]({
    baseUrl: baseUrl,
    paths: aliasMapPaths
});
function default_1() {
    return {
        visitor: {
            ImportDeclaration: function (path, source) {
                if (!tsconfigInfo) {
                    throw new Error('please set tsconfig.json');
                }
                if (!tsconfigInfo.compilerOptions || !(tsconfigInfo.compilerOptions && tsconfigInfo.compilerOptions.paths)) {
                    throw new Error('please set tsconfig.json tsconfigInfo.compilerOptions.paths');
                }
                var oldImportDeclare = path.node.source.value;
                var fileName = source.filename;
                var relativePath = pathHost.changeModulePath(fileName, oldImportDeclare, 'relative');
                path.node.source.value = relativePath;
            }
        }
    };
}
exports["default"] = default_1;
